# Description:  Seamonkey Web-Browser
# URL:          http://www.seamonkey-project.org
# Packager:	
# Maintainer:   Lin SiFuh, #crux at freenode dot net
# Depends on:   git lld clang python pango unzip zip autoconf-2.13 gconf gtk gtk3 pulseaudio yasm xorg-libxt rust startup-notification nss nspr hunspell icu

#cbindgen clang libidl libnotify libxkbcommon nodejs nss 

name=seamonkey
version=2.53.3
release=1
source=(https://archive.mozilla.org/pub/$name/releases/$version/source/$name-$version.source.tar.xz \
mozconfig )
        
build() {

  cd $name-$version
  sed -i -e '/pid_t gettid/,+3 s@^@//@' mozilla/tools/profiler/core/platform.h

  cd mozilla

  cd ../
  cp ../mozconfig .mozconfig

  make -f client.mk build
  make -f client.mk DESTDIR="${PKG}" INSTALL_SDK= install
  
  rm -rf "${PKG}"/usr/lib/${name}/{dictionaries,hyphenation}
  ln -s /usr/share/hunspell "${PKG}/usr/lib/${name}/dictionaries"
  ln -s /usr/share/hyphen "${PKG}/usr/lib/${name}/hyphenation"

  install -Dm644 suite/branding/${name}/default128.png \
          "${PKG}/usr/share/pixmaps/${name}.png"

  install -Dm644 mozilla/toolkit/mozapps/installer/linux/rpm/mozilla.desktop \
                "${PKG}/usr/share/applications/${name}.desktop"
  sed -i 's/@MOZ_APP_DISPLAYNAME@/SeaMonkey internet suite/' \
                "${PKG}/usr/share/applications/${name}.desktop"
  sed -i 's/@MOZ_APP_NAME@/${name}/' "${PKG}/usr/share/applications/${name}.desktop"

  install -d ${PKG}/etc/revdep.d
  echo "/usr/lib/${name}" > ${PKG}/etc/revdep.d/${name}

}
